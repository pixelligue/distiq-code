# Distiq Code v2.0 ‚Äî Implementation Plan

> **–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 6 —Ñ–µ–≤—Ä–∞–ª—è 2026  
> **–¶–µ–ª—å:** –ü–æ—Å—Ç—Ä–æ–∏—Ç—å cost-effective AI coding assistant —Å —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å—é ~$20-25/–º–µ—Å—è—Ü –∏ –ø—Ä–æ–¥–∞–∂–µ–π –∑–∞ $50  
> **–°—Ä–æ–∫:** 6-7 –Ω–µ–¥–µ–ª—å  

---

## ÔøΩ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω—ã–π —á–∞—Ç

–£ –Ω–∞—Å —É–∂–µ –µ—Å—Ç—å —Ä–∞–±–æ—Ç–∞—é—â–∏–π —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω—ã–π —á–∞—Ç –≤ `cli.py` —Å:
- ‚úÖ Smart routing (ML + regex) ‚Äî `routing.py`, `embedding_router.py`
- ‚úÖ Semantic cache ‚Äî `cache/semantic_cache.py`
- ‚úÖ Compression ‚Äî `compression/compressor.py`
- ‚úÖ Stats tracking ‚Äî `stats/`
- ‚úÖ Image support ‚Äî `clipboard.py`
- ‚úÖ Basic tools ‚Äî Read, Glob, Grep, Bash
- ‚úÖ Cursor integration ‚Äî `cursor/`

### –ö–∞—Ä—Ç–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –Ω–æ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                         EXISTING cli.py _chat_loop()                        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                             ‚îÇ
‚îÇ   [NEW] Phase 2: Code Indexing                                              ‚îÇ
‚îÇ   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ                                               ‚îÇ
‚îÇ   –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞: –ø–æ—Å–ª–µ –≤–≤–æ–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –î–û –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ –º–æ–¥–µ–ª—å               ‚îÇ
‚îÇ   –§–∞–π–ª: cli.py line ~657 (messages.append)                                  ‚îÇ
‚îÇ                                                                             ‚îÇ
‚îÇ   + context = await context_builder.build(user_input)  # NEW                ‚îÇ
‚îÇ   + messages_with_context = inject_context(messages, context)  # NEW        ‚îÇ
‚îÇ                                                                             ‚îÇ
‚îÇ   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ         ‚îÇ
‚îÇ                                                                             ‚îÇ
‚îÇ   [NEW] Phase 1: Multi-Provider                                             ‚îÇ
‚îÇ   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ                                           ‚îÇ
‚îÇ   –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞: –≤–º–µ—Å—Ç–æ ClaudeCliProvider                                     ‚îÇ
‚îÇ   –§–∞–π–ª: cli.py line ~482-486                                                ‚îÇ
‚îÇ                                                                             ‚îÇ
‚îÇ   - from distiq_code.auth.cli_provider import ClaudeCliProvider             ‚îÇ
‚îÇ   - provider = ClaudeCliProvider()                                          ‚îÇ
‚îÇ   + from distiq_code.orchestrator import Orchestrator                       ‚îÇ
‚îÇ   + orchestrator = Orchestrator()  # Uses multi-provider internally         ‚îÇ
‚îÇ                                                                             ‚îÇ
‚îÇ   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ         ‚îÇ
‚îÇ                                                                             ‚îÇ
‚îÇ   [NEW] Phase 3: Adaptive Planning                                          ‚îÇ
‚îÇ   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ                                           ‚îÇ
‚îÇ   –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞: –í–ù–£–¢–†–ò Orchestrator, –Ω–µ –≤ cli.py                             ‚îÇ
‚îÇ   Orchestrator —Å–∞–º —Ä–µ—à–∞–µ—Ç: planning ‚Üí execution                             ‚îÇ
‚îÇ                                                                             ‚îÇ
‚îÇ   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ         ‚îÇ
‚îÇ                                                                             ‚îÇ
‚îÇ   [ENHANCE] Phase 4: Prompt Optimization                                    ‚îÇ
‚îÇ   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ                                   ‚îÇ
‚îÇ   –£–∂–µ –µ—Å—Ç—å: compressor (line 708)                                           ‚îÇ
‚îÇ   –î–æ–±–∞–≤–∏—Ç—å: history_summarizer (–∫–∞–∂–¥—ã–µ 10 —Å–æ–æ–±—â–µ–Ω–∏–π)                        ‚îÇ
‚îÇ   –§–∞–π–ª: cli.py line ~527 (messages: list)                                   ‚îÇ
‚îÇ                                                                             ‚îÇ
‚îÇ   + if len(messages) > 10:                                                  ‚îÇ
‚îÇ   +     messages = await history_summarizer.summarize(messages)             ‚îÇ
‚îÇ                                                                             ‚îÇ
‚îÇ   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ         ‚îÇ
‚îÇ                                                                             ‚îÇ
‚îÇ   [ENHANCE] Phase 5: Tools & Skills                                         ‚îÇ
‚îÇ   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ                                         ‚îÇ
‚îÇ   –£–∂–µ –µ—Å—Ç—å: CHAT_TOOLS = ["Read", "Glob", "Grep", "Bash"]                   ‚îÇ
‚îÇ   –î–æ–±–∞–≤–∏—Ç—å: web_search, skills system                                       ‚îÇ
‚îÇ   –§–∞–π–ª: cli.py line ~434                                                    ‚îÇ
‚îÇ                                                                             ‚îÇ
‚îÇ   - CHAT_TOOLS = ["Read", "Glob", "Grep", "Bash"]                           ‚îÇ
‚îÇ   + CHAT_TOOLS = get_available_tools()  # Dynamic from registry             ‚îÇ
‚îÇ                                                                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏:

| –§–∞–π–ª | –ß—Ç–æ –º–µ–Ω—è—Ç—å |
|------|------------|
| `cli.py` | –ó–∞–º–µ–Ω–∏—Ç—å ClaudeCliProvider ‚Üí Orchestrator |
| `cli.py` | –î–æ–±–∞–≤–∏—Ç—å context injection –∏–∑ indexer |
| `cli.py` | –î–æ–±–∞–≤–∏—Ç—å history summarization |
| `cli.py` | –ü–æ–¥–∫–ª—é—á–∏—Ç—å dynamic tools registry |
| `routing.py` | –†–∞—Å—à–∏—Ä–∏—Ç—å complexity classifier |
| `config.py` | –î–æ–±–∞–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –Ω–æ–≤—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ |

### –ü—Ä–∏–Ω—Ü–∏–ø –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏:

```python
# –í cli.py ‚Äî –ø–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥

# Old way (still works)
if settings.use_legacy_provider:
    provider = ClaudeCliProvider()
    response = await provider.complete(messages)
   
# New way (Orchestrator)
else:
    orchestrator = Orchestrator()
    response = await orchestrator.process(
        user_input,
        context=indexed_context,
        history=messages,
    )
```

---

## ÔøΩüìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [Phase 1: Multi-Provider Infrastructure](#phase-1-multi-provider-infrastructure)
2. [Phase 2: Code Indexing & RAG](#phase-2-code-indexing--rag)
3. [Phase 3: Adaptive Planning Router](#phase-3-adaptive-planning-router)
4. [Phase 4: Prompt Optimization](#phase-4-prompt-optimization)
5. [Phase 5: Tools & Skills System](#phase-5-tools--skills-system)
6. [Phase 6: Integration & Polish](#phase-6-integration--polish)

---

## üéØ –û–±—â–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

### –ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –∫–∞–∂–¥–æ–π —Ñ–∞–∑—ã:
```
‚ö†Ô∏è –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û: –ü—Ä–æ–≤–µ—Ä—å –∞–∫—Ç—É–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ!

–ü–æ–∏—Å–∫–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:
- "[–Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏] latest version 2026"
- "[–Ω–∞–∑–≤–∞–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏] breaking changes 2026"
- "[–Ω–∞–∑–≤–∞–Ω–∏–µ API] pricing February 2026"
- "[–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã] vs [–Ω–∞—à –≤—ã–±–æ—Ä] benchmark 2026"
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏:
- **–ß—Ç–æ –¥–µ–ª–∞–µ–º** ‚Äî –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
- **–ó–∞—á–µ–º** ‚Äî –±–∏–∑–Ω–µ—Å-–ø—Ä–∏—á–∏–Ω–∞
- **–†–µ—Å—É—Ä—Å—ã** ‚Äî —Å—Å—ã–ª–∫–∏ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- **–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏** ‚Äî –∫–∞–∫ –ø–æ–Ω—è—Ç—å —á—Ç–æ —Å–¥–µ–ª–∞–Ω–æ
- **–í—Ä–µ–º—è** ‚Äî –æ—Ü–µ–Ω–∫–∞ –≤ —á–∞—Å–∞—Ö

---

# Phase 1: Multi-Provider Infrastructure

**–°—Ä–æ–∫:** –ù–µ–¥–µ–ª—è 1  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** üü° –°—Ä–µ–¥–Ω—è—è  
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** Backend Developer  

## üîç –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ

```
–ü–ï–†–ï–î –ù–ê–ß–ê–õ–û–ú ‚Äî –ø—Ä–æ–≤–µ—Ä—å –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ:

1. "DeepSeek API documentation 2026"
   - –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ endpoints
   - Pricing (–æ–∂–∏–¥–∞–µ–º ~$0.28/MTok)
   - Rate limits
   
2. "Claude API prompt caching February 2026"
   - –§–æ—Ä–º–∞—Ç cache_control
   - –ö–∞–∫–∏–µ –º–æ–¥–µ–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç
   - –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—ã

3. "OpenRouter API pricing 2026 fees"
   - –ê–∫—Ç—É–∞–ª—å–Ω–∞—è –∫–æ–º–∏—Å—Å–∏—è (–æ–∂–∏–¥–∞–µ–º ~5%)
   - –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥–µ–ª–∏

4. "best async HTTP client Python 2026"
   - httpx vs aiohttp –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ
```

## –ó–∞–¥–∞—á–∏

### 1.1 –°–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
**–í—Ä–µ–º—è:** 2 —á–∞—Å–∞  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** üü¢ –õ–µ–≥–∫–æ

```
–§–∞–π–ª: src/distiq_code/providers/base.py

–ß—Ç–æ –¥–µ–ª–∞–µ–º:
- –ê–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –∫–ª–∞—Å—Å BaseProvider
- –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö: ProviderPricing, ProviderResponse
- –ú–µ—Ç–æ–¥—ã: generate(), stream(), calculate_cost()

–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:
- [ ] –ö–ª–∞—Å—Å BaseProvider —Å–æ–∑–¥–∞–Ω
- [ ] –í—Å–µ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
- [ ] Type hints –≤–µ–∑–¥–µ –ø—Ä–æ—Å—Ç–∞–≤–ª–µ–Ω—ã
- [ ] Docstrings –Ω–∞–ø–∏—Å–∞–Ω—ã
```

**–†–µ—Å—É—Ä—Å—ã:**
- –¢–µ–∫—É—â–∏–π `routing.py` ‚Äî –ø–æ—Å–º–æ—Ç—Ä–∏ –∫–∞–∫ —Å–¥–µ–ª–∞–Ω pricing
- https://docs.python.org/3/library/abc.html

---

### 1.2 Anthropic Provider (—Å Prompt Caching)
**–í—Ä–µ–º—è:** 4 —á–∞—Å–∞  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** üü° –°—Ä–µ–¥–Ω—è—è  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–û–¢–û–í–û

```
–§–∞–π–ª: src/distiq_code/providers/anthropic.py

–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è BaseProvider –¥–ª—è Claude API
- Prompt caching —á–µ—Ä–µ–∑ cache_control
- –ü–æ–¥—Å—á—ë—Ç cached_tokens –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏
- httpx —Å HTTP/2
- Streaming support

Pricing (–∞–∫—Ç—É–∞–ª—å–Ω–æ —Ñ–µ–≤—Ä–∞–ª—å 2026):
- Sonnet: $3/MTok input, $15/MTok output
- Haiku: $1/MTok input, $5/MTok output
- Opus: $15/MTok input, $75/MTok output
- Cache hit: 90% –¥–µ—à–µ–≤–ª–µ!

–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:
- [x] generate() —Ä–∞–±–æ—Ç–∞–µ—Ç —Å Sonnet –∏ Haiku
- [x] stream() —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] Prompt caching –≤–∫–ª—é—á–∞–µ—Ç—Å—è
- [x] –°—Ç–æ–∏–º–æ—Å—Ç—å —Å—á–∏—Ç–∞–µ—Ç—Å—è —Å —É—á—ë—Ç–æ–º –∫—ç—à–∞
- [ ] –¢–µ—Å—Ç: –æ—Ç–ø—Ä–∞–≤–∏—Ç—å 2 –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–∞, –≤—Ç–æ—Ä–æ–π –¥–µ—à–µ–≤–ª–µ
```

**–†–µ—Å—É—Ä—Å—ã:**
- https://docs.anthropic.com/en/docs/build-with-claude/prompt-caching
- https://docs.anthropic.com/en/api/messages

---


### 1.3 DeepSeek Provider
**–í—Ä–µ–º—è:** 3 —á–∞—Å–∞  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** üü¢ –õ–µ–≥–∫–æ

```
–§–∞–π–ª: src/distiq_code/providers/deepseek.py

–ß—Ç–æ –¥–µ–ª–∞–µ–º:
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è BaseProvider –¥–ª—è DeepSeek API
- OpenAI-compatible —Ñ–æ—Ä–º–∞—Ç
- –ü–æ–¥—Å—á—ë—Ç prompt_cache_hit_tokens

‚ö†Ô∏è –í–ê–ñ–ù–û: DeepSeek –∏–º–µ–µ—Ç —Å–≤–æ–π –∫—ç—à!
- Cache hit: $0.028/MTok (–≤ 10 —Ä–∞–∑ –¥–µ—à–µ–≤–ª–µ!)
- Cache miss: $0.28/MTok

–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:
- [ ] generate() —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] stream() —Ä–∞–±–æ—Ç–∞–µ—Ç  
- [ ] –ö—ç—à —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤ —Ä–∞—Å—á—ë—Ç–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
- [ ] –¢–µ—Å—Ç: –ø—Ä–æ—Å—Ç–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
```

**–†–µ—Å—É—Ä—Å—ã:**
- https://platform.deepseek.com/docs
- https://api-docs.deepseek.com/

---

### 1.4 OpenRouter Provider (fallback)
**–í—Ä–µ–º—è:** 2 —á–∞—Å–∞  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** üü¢ –õ–µ–≥–∫–æ

```
–§–∞–π–ª: src/distiq_code/providers/openrouter.py

–ß—Ç–æ –¥–µ–ª–∞–µ–º:
- Fallback –ø—Ä–æ–≤–∞–π–¥–µ—Ä —á–µ—Ä–µ–∑ OpenRouter
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ª—é–±–æ–π –º–æ–¥–µ–ª–∏ –ø–æ model_id
- –£—á—ë—Ç 5% –∫–æ–º–∏—Å—Å–∏–∏ –≤ —Ä–∞—Å—á—ë—Ç–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏

–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
- –ï—Å–ª–∏ DeepSeek –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ —ç–∫–∑–æ—Ç–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å

–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:
- [ ] –ú–æ–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å –ª—é–±—É—é –º–æ–¥–µ–ª—å –ø–æ ID
- [ ] –ö–æ–º–∏—Å—Å–∏—è —É—á—Ç–µ–Ω–∞ –≤ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
- [ ] –†–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ fallback
```

**–†–µ—Å—É—Ä—Å—ã:**
- https://openrouter.ai/docs

---

### 1.5 Provider Registry & Factory
**–í—Ä–µ–º—è:** 2 —á–∞—Å–∞  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** üü¢ –õ–µ–≥–∫–æ

```
–§–∞–π–ª: src/distiq_code/providers/__init__.py

–ß—Ç–æ –¥–µ–ª–∞–µ–º:
- –†–µ–µ—Å—Ç—Ä –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
- Factory method: get_provider(name)
- –ö–æ–Ω—Ñ–∏–≥: –∫–∞–∫–æ–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä –¥–ª—è –∫–∞–∫–æ–π –∑–∞–¥–∞—á–∏

–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
  provider = get_provider("deepseek")
  response = await provider.generate(messages, model="deepseek-chat")

–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:
- [ ] get_provider() –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω—É–∂–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä
- [ ] –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è (singleton)
- [ ] Graceful fallback –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
```

---

### 1.6 Cost Tracker
**–í—Ä–µ–º—è:** 3 —á–∞—Å–∞  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** üü° –°—Ä–µ–¥–Ω—è—è

```
–§–∞–π–ª: src/distiq_code/stats/cost_tracker.py

–ß—Ç–æ –¥–µ–ª–∞–µ–º:
- –¢—Ä–µ–∫–∏–Ω–≥ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- –ê–≥—Ä–µ–≥–∞—Ü–∏—è –ø–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º, –º–æ–¥–µ–ª—è–º, –≤—Ä–µ–º–µ–Ω–∏
- –ê–ª–µ—Ä—Ç—ã –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–æ–≤

–î–∞–Ω–Ω—ã–µ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:
- timestamp
- provider, model
- input_tokens, output_tokens, cached_tokens
- cost_usd
- request_type (planning/execution)

–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:
- [ ] –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è
- [ ] –ú–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å stats –∑–∞ –ø–µ—Ä–∏–æ–¥
- [ ] –ê–ª–µ—Ä—Ç –µ—Å–ª–∏ cost > threshold
```

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è Phase 1

- [ ] –í—Å–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- [ ] –¢–µ—Å—Ç—ã –Ω–∞ –∫–∞–∂–¥—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä
- [ ] Cost tracking —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- [ ] Code review –ø—Ä–æ–π–¥–µ–Ω

---

# Phase 2: Code Indexing & RAG

**–°—Ä–æ–∫:** –ù–µ–¥–µ–ª—è 2-3  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** üî¥ –í—ã—Å–æ–∫–∞—è  
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** Backend Developer —Å –æ–ø—ã—Ç–æ–º ML  

## üîç –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ

```
–ü–ï–†–ï–î –ù–ê–ß–ê–õ–û–ú ‚Äî –ø—Ä–æ–≤–µ—Ä—å –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ:

1. "tree-sitter Python bindings 2026"
   - py-tree-sitter vs tree-sitter-languages
   - –ö–∞–∫–∏–µ —è–∑—ã–∫–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è

2. "best code embedding model 2026 benchmark"
   - Nomic Embed Code vs Voyage Code vs Jina
   - –†–∞–∑–º–µ—Ä—ã –º–æ–¥–µ–ª–µ–π, –∫–∞—á–µ—Å—Ç–≤–æ

3. "FAISS vs Milvus vs Chroma 2026 comparison"
   - –ß—Ç–æ –ª—É—á—à–µ –¥–ª—è –Ω–∞—à–µ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ (10K-100K chunks)
   
4. "CocoIndex RAG code indexing"
   - –ò–∑—É—á–∏—Ç—å –∏—Ö –ø–æ–¥—Ö–æ–¥ –∫ chunking
```

## –ó–∞–¥–∞—á–∏

### 2.1 Tree-sitter Parser Integration
**–í—Ä–µ–º—è:** 6 —á–∞—Å–æ–≤  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** üü° –°—Ä–µ–¥–Ω—è—è

```
–§–∞–π–ª: src/distiq_code/indexing/parser.py

–ß—Ç–æ –¥–µ–ª–∞–µ–º:
- –ü–∞—Ä—Å–∏–Ω–≥ –∫–æ–¥–∞ –≤ AST —á–µ—Ä–µ–∑ Tree-sitter
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞: Python, JavaScript, TypeScript, Go, Rust, Java
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ semantic chunks

–¢–∏–ø—ã chunks:
- function: –ø–æ–ª–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å docstring
- class: –∫–ª–∞—Å—Å —Å –º–µ—Ç–æ–¥–∞–º–∏
- import_block: –≥—Ä—É–ø–ø–∞ –∏–º–ø–æ—Ä—Ç–æ–≤
- config: –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –±–ª–æ–∫–∏

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ chunk:
{
  "type": "function",
  "name": "calculate_cost",
  "file_path": "src/providers/base.py",
  "start_line": 45,
  "end_line": 62,
  "content": "def calculate_cost(...)...",
  "signature": "def calculate_cost(self, model: str, ...) -> float",
  "docstring": "Calculate cost in USD...",
  "dependencies": ["ProviderPricing"]
}

–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:
- [ ] –ü–∞—Ä—Å–∏–Ω–≥ Python —Ñ–∞–π–ª–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ü–∞—Ä—Å–∏–Ω–≥ JS/TS —Ñ–∞–π–ª–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Chunks –∏–º–µ—é—Ç –≤—Å–µ –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è
- [ ] –¢–µ—Å—Ç: —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç
```

**–†–µ—Å—É—Ä—Å—ã:**
- https://github.com/tree-sitter/py-tree-sitter
- https://tree-sitter.github.io/tree-sitter/

---

### 2.2 Code Embedding Model
**–í—Ä–µ–º—è:** 4 —á–∞—Å–∞  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** üü° –°—Ä–µ–¥–Ω—è—è

```
–§–∞–π–ª: src/distiq_code/indexing/embedder.py

–ß—Ç–æ –¥–µ–ª–∞–µ–º:
- –ó–∞–≥—Ä—É–∑–∫–∞ Nomic Embed Code –º–æ–¥–µ–ª–∏
- Batch embedding –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ embeddings

–í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ (–ø—Ä–æ–≤–µ—Ä—å –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å!):
- Nomic Embed Code ‚Äî open source, –ª–æ–∫–∞–ª—å–Ω–æ
- Jina Code V2 ‚Äî –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞
- CodeSage ‚Äî –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –∫–∞—á–µ—Å—Ç–≤–æ –≤—ã—à–µ

–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:
- [ ] –ú–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
- [ ] embed(text) ‚Üí vector —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] embed_batch(texts) ‚Üí vectors —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –í—Ä–µ–º—è: <10ms –Ω–∞ –æ–¥–∏–Ω chunk
```

**–†–µ—Å—É—Ä—Å—ã:**
- https://huggingface.co/nomic-ai/nomic-embed-code
- https://huggingface.co/jinaai/jina-embeddings-v2-base-code

---

### 2.3 Vector Index (FAISS)
**–í—Ä–µ–º—è:** 4 —á–∞—Å–∞  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** üü° –°—Ä–µ–¥–Ω—è—è

```
–§–∞–π–ª: src/distiq_code/indexing/vector_store.py

–ß—Ç–æ –¥–µ–ª–∞–µ–º:
- FAISS index –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è embeddings
- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤ SQLite
- –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

–°—Ç—Ä—É–∫—Ç—É—Ä–∞:
/project/.distiq-code/
  ‚îú‚îÄ‚îÄ index.faiss        # Vector index
  ‚îú‚îÄ‚îÄ metadata.db        # SQLite —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ chunks
  ‚îî‚îÄ‚îÄ file_hashes.json   # –î–ª—è delta updates

–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:
- [ ] add_chunks(chunks) —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] search(query, k=10) –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ
- [ ] –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å: –ø–æ—Å–ª–µ —Ä–µ—Å—Ç–∞—Ä—Ç–∞ –¥–∞–Ω–Ω—ã–µ –Ω–∞ –º–µ—Å—Ç–µ
- [ ] Delta update: –∏–∑–º–µ–Ω–∏–ª—Å—è —Ñ–∞–π–ª ‚Üí –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –µ–≥–æ
```

**–†–µ—Å—É—Ä—Å—ã:**
- –£–∂–µ –µ—Å—Ç—å: `cache/semantic_cache.py` ‚Äî –≤–∑—è—Ç—å –∑–∞ –æ—Å–Ω–æ–≤—É!

---

### 2.4 File Watcher
**–í—Ä–µ–º—è:** 3 —á–∞—Å–∞  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** üü¢ –õ–µ–≥–∫–æ

```
–§–∞–π–ª: src/distiq_code/indexing/watcher.py

–ß—Ç–æ –¥–µ–ª–∞–µ–º:
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ñ–∞–π–ª–æ–≤
- Debounce (–Ω–µ —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –∫–∞–∂–¥—ã–π keystroke)
- –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ .gitignore –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤

–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞: watchdog (–∏–ª–∏ watchfiles)

Events:
- created ‚Üí index new file
- modified ‚Üí re-index file
- deleted ‚Üí remove from index

–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:
- [ ] –ò–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è
- [ ] .gitignore —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è
- [ ] Debounce 500ms —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫
```

**–†–µ—Å—É—Ä—Å—ã:**
- https://github.com/gorakhargosh/watchdog

---

### 2.5 Smart Context Builder
**–í—Ä–µ–º—è:** 6 —á–∞—Å–æ–≤  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** üî¥ –í—ã—Å–æ–∫–∞—è

```
–§–∞–π–ª: src/distiq_code/indexing/context_builder.py

–ß—Ç–æ –¥–µ–ª–∞–µ–º:
- –ü–æ –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞–π—Ç–∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π –∫–æ–¥
- –î–æ–±–∞–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (imports, related classes)
- –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç

–ê–ª–≥–æ—Ä–∏—Ç–º:
1. Semantic search –ø–æ –∑–∞–ø—Ä–æ—Å—É ‚Üí Top 10 chunks
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ chunk ‚Üí –Ω–∞–π—Ç–∏ dependencies
3. –î–æ–±–∞–≤–∏—Ç—å recently edited files (boost)
4. –†–∞–Ω–∂–∏—Ä–æ–≤–∞—Ç—å –∏ –≤–∑—è—Ç—å Top K –ø–æ token budget
5. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è LLM

–ü—Ä–∏–º–µ—Ä output:
```
## Relevant Code

### src/providers/base.py (lines 45-62)
```python
def calculate_cost(self, model: str, ...) -> float:
    """Calculate cost in USD for a request."""
    ...
```

### src/providers/anthropic.py (uses calculate_cost)
...
```

–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:
- [ ] build_context(query, max_tokens=8000) —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Dependencies –≤–∫–ª—é—á–∞—é—Ç—Å—è
- [ ] Token budget –Ω–µ –ø—Ä–µ–≤—ã—à–∞–µ—Ç—Å—è
- [ ] –ö–∞—á–µ—Å—Ç–≤–æ: —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π –∫–æ–¥ –Ω–∞ –ø–µ—Ä–≤–æ–º –º–µ—Å—Ç–µ
```

---

### 2.6 Initial Indexing CLI
**–í—Ä–µ–º—è:** 2 —á–∞—Å–∞  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** üü¢ –õ–µ–≥–∫–æ

```
–î–æ–±–∞–≤–∏—Ç—å –≤: src/distiq_code/cli.py

–ö–æ–º–∞–Ω–¥—ã:
- distiq-code index       # –ü–æ–ª–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è
- distiq-code index-stats # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–Ω–¥–µ–∫—Å–∞
- distiq-code search "query" # –¢–µ—Å—Ç –ø–æ–∏—Å–∫–∞

–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:
- [ ] –ö–æ–º–∞–Ω–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] Progress bar –ø—Ä–∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
- [ ] –í—Ä–µ–º—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –¥–ª—è 1000 —Ñ–∞–π–ª–æ–≤ < 60 —Å–µ–∫
```

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è Phase 2

- [ ] Tree-sitter –ø–∞—Ä—Å–∏—Ç –≤—Å–µ –Ω—É–∂–Ω—ã–µ —è–∑—ã–∫–∏
- [ ] Embedding –º–æ–¥–µ–ª—å —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ
- [ ] FAISS index –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–π
- [ ] File watcher –Ω–µ –ø–∞–¥–∞–µ—Ç
- [ ] Context builder –≤—ã–¥–∞—ë—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π –∫–æ–¥
- [ ] CLI –∫–æ–º–∞–Ω–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] Benchmark: –ø–æ–∏—Å–∫ < 100ms

---

# Phase 3: Adaptive Planning Router

**–°—Ä–æ–∫:** –ù–µ–¥–µ–ª—è 3  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** üü° –°—Ä–µ–¥–Ω—è—è  
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** Backend Developer  

## üîç –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ

```
–ü–ï–†–ï–î –ù–ê–ß–ê–õ–û–ú ‚Äî –ø—Ä–æ–≤–µ—Ä—å –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ:

1. "Claude Haiku 4.5 vs Sonnet 4.5 coding benchmark 2026"
   - –ù–∞ –∫–∞–∫–∏—Ö –∑–∞–¥–∞—á–∞—Ö Haiku –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ö–æ—Ä–æ—à
   - –ì–¥–µ –Ω—É–∂–µ–Ω Sonnet

2. "DeepSeek V3.2 code generation quality 2026"
   - –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å Claude –Ω–∞ coding tasks
   - –°–∏–ª—å–Ω—ã–µ –∏ —Å–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã

3. "LLM routing strategies 2026"
   - –ö–∞–∫–∏–µ –ø–æ–¥—Ö–æ–¥—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –¥—Ä—É–≥–∏–µ
   - Martian Router, RouteLLM
```

## –ó–∞–¥–∞—á–∏

### 3.1 Complexity Classifier
**–í—Ä–µ–º—è:** 4 —á–∞—Å–∞  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** üü° –°—Ä–µ–¥–Ω—è—è

```
–§–∞–π–ª: src/distiq_code/routing/classifier.py

–ß—Ç–æ –¥–µ–ª–∞–µ–º:
- –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–∞: simple / medium / complex
- –ö–æ–º–±–∏–Ω–∞—Ü–∏—è regex + embedding similarity

–ü—Ä–∏–∑–Ω–∞–∫–∏ SIMPLE (‚Üí DeepSeek –Ω–∞–ø—Ä—è–º—É—é):
- "–∏—Å–ø—Ä–∞–≤—å typo", "–¥–æ–±–∞–≤—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π"
- "–ø–µ—Ä–µ–∏–º–µ–Ω—É–π X –≤ Y"
- –ö–æ—Ä–æ—Ç–∫–∏–π –∑–∞–ø—Ä–æ—Å < 50 —Å–ª–æ–≤
- –ù–µ—Ç —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

–ü—Ä–∏–∑–Ω–∞–∫–∏ MEDIUM (‚Üí Haiku plan ‚Üí DeepSeek):
- "–Ω–∞–ø–∏—à–∏ —Ñ—É–Ω–∫—Ü–∏—é", "–¥–æ–±–∞–≤—å —ç–Ω–¥–ø–æ–∏–Ω—Ç"
- "–∏—Å–ø—Ä–∞–≤—å –±–∞–≥ –≤ X"
- –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –∑–∞–¥–∞—á–∞, 1-3 —Ñ–∞–π–ª–∞

–ü—Ä–∏–∑–Ω–∞–∫–∏ COMPLEX (‚Üí Sonnet plan ‚Üí DeepSeek):
- "—Å–ø—Ä–æ–µ–∫—Ç–∏—Ä—É–π", "–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞"
- "–ø–µ—Ä–µ–ø–∏—à–∏ –º–æ–¥—É–ª—å", "—Ä–µ—Ñ–∞–∫—Ç–æ—Ä –≤—Å–µ–≥–æ"
- –ú–Ω–æ–≥–æ —Ñ–∞–π–ª–æ–≤, —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:
- [ ] classify(prompt) ‚Üí "simple" | "medium" | "complex"
- [ ] –¢–µ—Å—Ç –Ω–∞ 100 –ø—Ä–∏–º–µ—Ä–∞—Ö: accuracy > 85%
- [ ] –í—Ä–µ–º—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ < 50ms
```

**–†–µ—Å—É—Ä—Å—ã:**
- –£–∂–µ –µ—Å—Ç—å: `routing.py` ‚Äî —Ä–∞—Å—à–∏—Ä–∏—Ç—å!
- –£–∂–µ –µ—Å—Ç—å: `embedding_router.py` ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

---

### 3.2 Planning Prompt Templates
**–í—Ä–µ–º—è:** 3 —á–∞—Å–∞  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** üü° –°—Ä–µ–¥–Ω—è—è

```
–§–∞–π–ª: src/distiq_code/prompts/planning.py

–ß—Ç–æ –¥–µ–ª–∞–µ–º:
- –®–∞–±–ª–æ–Ω—ã –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è planning phase
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π output (JSON plan)

–ü–ª–∞–Ω –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å:
{
  "summary": "–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —á—Ç–æ –¥–µ–ª–∞–µ–º",
  "files": [
    {
      "path": "src/example.py",
      "action": "modify",
      "changes": [
        {
          "type": "replace",
          "search": "old code",
          "replace": "new code",
          "reason": "–ø–æ—á–µ–º—É –º–µ–Ω—è–µ–º"
        }
      ]
    }
  ],
  "tests_needed": true,
  "estimated_complexity": "medium"
}

–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:
- [ ] –ü—Ä–æ–º–ø—Ç—ã –¥–ª—è Haiku –∏ Sonnet
- [ ] Output –ø–∞—Ä—Å–∏—Ç—Å—è –∫–∞–∫ –≤–∞–ª–∏–¥–Ω—ã–π JSON
- [ ] –ü–ª–∞–Ω—ã –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ—Ç–∞–ª—å–Ω—ã–µ –¥–ª—è DeepSeek
```

---

### 3.3 Execution Prompt Templates
**–í—Ä–µ–º—è:** 3 —á–∞—Å–∞  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** üü° –°—Ä–µ–¥–Ω—è—è

```
–§–∞–π–ª: src/distiq_code/prompts/execution.py

–ß—Ç–æ –¥–µ–ª–∞–µ–º:
- –ü—Ä–æ–º–ø—Ç—ã –¥–ª—è DeepSeek execution
- –ü–µ—Ä–µ–¥–∞—á–∞ –ø–ª–∞–Ω–∞ + –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥ output

–§–æ—Ä–º–∞—Ç –¥–ª—è DeepSeek:
```
You are a code execution agent. Follow the plan exactly.

## Plan
{plan_json}

## Current Code
{relevant_code}

## Instructions
Generate the code changes as specified in the plan.
Output format: <file path="...">code</file>
```

–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:
- [ ] DeepSeek –ø–æ–Ω–∏–º–∞–µ—Ç –ø–ª–∞–Ω
- [ ] Output –º–æ–∂–Ω–æ —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å
- [ ] –ö–æ–¥ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π
```

---

### 3.4 Orchestrator
**–í—Ä–µ–º—è:** 6 —á–∞—Å–æ–≤  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** üî¥ –í—ã—Å–æ–∫–∞—è

```
–§–∞–π–ª: src/distiq_code/orchestrator.py

–ß—Ç–æ –¥–µ–ª–∞–µ–º:
- –ì–ª–∞–≤–Ω—ã–π pipeline: request ‚Üí response
- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

Flow:
1. Classify request
2. Build context (from index)
3. Check semantic cache
4. If cache miss:
   a. Plan (if needed): Haiku/Sonnet
   b. Execute: DeepSeek
   c. Validate: local linters
5. Track cost
6. Return response

class Orchestrator:
    async def process(self, request: str) -> Response:
        complexity = self.classifier.classify(request)
        context = self.context_builder.build(request)
        
        # Check cache
        cached = self.cache.get(request)
        if cached:
            return cached
        
        # Route based on complexity
        if complexity == "simple":
            code = await self.execute_direct(request, context)
        elif complexity == "medium":
            plan = await self.plan(request, context, model="haiku")
            code = await self.execute(plan, context)
        else:
            plan = await self.plan(request, context, model="sonnet")
            code = await self.execute(plan, context)
        
        # Validate
        validated = self.validator.check(code)
        
        # Cache & track
        self.cache.set(request, validated)
        self.cost_tracker.record(...)
        
        return validated

–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:
- [ ] End-to-end flow —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –í—Å–µ —Ç—Ä–∏ complexity paths —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Cost tracking —Ä–∞–±–æ—Ç–∞–µ—Ç
```

---

### 3.5 Fallback & Retry Logic
**–í—Ä–µ–º—è:** 3 —á–∞—Å–∞  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** üü° –°—Ä–µ–¥–Ω—è—è

```
–î–æ–±–∞–≤–∏—Ç—å –≤: src/distiq_code/orchestrator.py

–ß—Ç–æ –¥–µ–ª–∞–µ–º:
- Retry –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö API
- Fallback –Ω–∞ –¥—Ä—É–≥–æ–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä
- Upgrade –º–æ–¥–µ–ª–∏ –µ—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–ª–æ—Ö–æ–π

–°—Ü–µ–Ω–∞—Ä–∏–∏:
1. DeepSeek –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí OpenRouter DeepSeek
2. DeepSeek –≤—ã–¥–∞–ª –ø–ª–æ—Ö–æ–π –∫–æ–¥ ‚Üí retry —Å Haiku
3. Haiku –ø–ª–∞–Ω –Ω–µ–ø–æ–Ω—è—Ç–µ–Ω ‚Üí upgrade –¥–æ Sonnet
4. Rate limit ‚Üí exponential backoff

–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:
- [ ] Retry 3 —Ä–∞–∑–∞ —Å backoff
- [ ] Fallback –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] Upgrade –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –õ–æ–≥–∏ –ø–æ–Ω—è—Ç–Ω—ã–µ
```

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è Phase 3

- [ ] Classifier —Ä–∞–±–æ—Ç–∞–µ—Ç —Å accuracy > 85%
- [ ] Planning –ø—Ä–æ–º–ø—Ç—ã –≥–µ–Ω–µ—Ä—è—Ç —Ö–æ—Ä–æ—à–∏–µ –ø–ª–∞–Ω—ã
- [ ] DeepSeek execution —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Orchestrator –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç –≤—Å—ë
- [ ] Fallback & retry –Ω–∞–¥—ë–∂–Ω—ã–µ
- [ ] Cost < $0.10 –Ω–∞ —Å—Ä–µ–¥–Ω–∏–π –∑–∞–ø—Ä–æ—Å

---

# Phase 4: Prompt Optimization

**–°—Ä–æ–∫:** –ù–µ–¥–µ–ª—è 4  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** üü° –°—Ä–µ–¥–Ω—è—è  
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** Backend Developer  

## üîç –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ

```
–ü–ï–†–ï–î –ù–ê–ß–ê–õ–û–ú ‚Äî –ø—Ä–æ–≤–µ—Ä—å –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ:

1. "LLMLingua 2 vs 3 comparison 2026"
   - –ï—Å—Ç—å –ª–∏ –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è?
   - –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–º–ø—Ä–µ—Å—Å–∏–∏

2. "Anthropic prompt caching best practices 2026"
   - –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä cache block
   - –ö–∞–∫–∏–µ —á–∞—Å—Ç–∏ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å

3. "conversation summarization LLM 2026"
   - –ö–∞–∫–∏–µ –º–æ–¥–µ–ª–∏ –ª—É—á—à–µ –¥–ª—è summarization
   - –ú–æ–∂–Ω–æ –ª–∏ –¥–µ–ª–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ
```

## –ó–∞–¥–∞—á–∏

### 4.1 History Summarization
**–í—Ä–µ–º—è:** 4 —á–∞—Å–∞  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** üü° –°—Ä–µ–¥–Ω—è—è

```
–§–∞–π–ª: src/distiq_code/optimization/history.py

–ß—Ç–æ –¥–µ–ª–∞–µ–º:
- –ü–æ—Å–ª–µ N —Å–æ–æ–±—â–µ–Ω–∏–π —Å–∂–∏–º–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é
- –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–ª—é—á–µ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
- –≠–∫–æ–Ω–æ–º–∏–º —Ç–æ–∫–µ–Ω—ã –Ω–∞ –ø–æ–≤—Ç–æ—Ä—è—é—â–µ–º—Å—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ

–ê–ª–≥–æ—Ä–∏—Ç–º:
1. –ö–∞–∂–¥—ã–µ 10 —Å–æ–æ–±—â–µ–Ω–∏–π ‚Üí summarize
2. Summary: —á—Ç–æ —Å–¥–µ–ª–∞–ª–∏, –∫–∞–∫–∏–µ —Ñ–∞–π–ª—ã –º–µ–Ω—è–ª–∏, —á—Ç–æ –≤–∞–∂–Ω–æ –ø–æ–º–Ω–∏—Ç—å
3. –°—Ç–∞—Ä—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è ‚Üí —É–¥–∞–ª—è–µ–º
4. Summary ‚Üí –≤ –Ω–∞—á–∞–ª–æ –∫–∞–∫ context

–ü—Ä–∏–º–µ—Ä summary:
"–í —ç—Ç–æ–π —Å–µ—Å—Å–∏–∏ –º—ã:
1. –°–æ–∑–¥–∞–ª–∏ auth –º–æ–¥—É–ª—å (src/auth/)
2. –î–æ–±–∞–≤–∏–ª–∏ JWT middleware
3. –ò—Å–ø—Ä–∞–≤–∏–ª–∏ –±–∞–≥ —Å refresh tokens
–¢–µ–∫—É—â–∏–π —Ñ–æ–∫—É—Å: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ OAuth2"

–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:
- [ ] Summarization —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Summary < 500 —Ç–æ–∫–µ–Ω–æ–≤
- [ ] –í–∞–∂–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ —Ç–µ—Ä—è–µ—Ç—Å—è
- [ ] –¢–µ—Å—Ç: 50 —Å–æ–æ–±—â–µ–Ω–∏–π ‚Üí summary –ø–æ–Ω—è—Ç–Ω—ã–π
```

---

### 4.2 LLMLingua Integration
**–í—Ä–µ–º—è:** 3 —á–∞—Å–∞  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** üü¢ –õ–µ–≥–∫–æ

```
–§–∞–π–ª: src/distiq_code/optimization/compression.py

–ß—Ç–æ –¥–µ–ª–∞–µ–º:
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è LLMLingua –¥–ª—è —Å–∂–∞—Ç–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ compression ratio
- Selective compression (–Ω–µ —Å–∂–∏–º–∞—Ç—å –∫–æ–¥!)

‚ö†Ô∏è –í–ê–ñ–ù–û: –ö–æ–¥ –Ω–µ —Å–∂–∏–º–∞–µ–º, —Ç–æ–ª—å–∫–æ natural language!

–ß—Ç–æ —Å–∂–∏–º–∞–µ–º:
- –î–ª–∏–Ω–Ω—ã–µ –æ–ø–∏—Å–∞–Ω–∏—è –∑–∞–¥–∞—á
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
- –û–±—ä—è—Å–Ω–µ–Ω–∏—è

–ß—Ç–æ –ù–ï —Å–∂–∏–º–∞–µ–º:
- –ö–æ–¥
- –ò–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤ –∏ —Ñ—É–Ω–∫—Ü–∏–π
- –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç–µ—Ä–º–∏–Ω—ã

–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:
- [ ] compress(text) —É–º–µ–Ω—å—à–∞–µ—Ç –Ω–∞ 2-3x
- [ ] –ö–æ–¥ –æ—Å—Ç–∞—ë—Ç—Å—è –Ω–µ—Ç—Ä–æ–Ω—É—Ç—ã–º
- [ ] –°–º—ã—Å–ª —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
```

**–†–µ—Å—É—Ä—Å—ã:**
- –£–∂–µ –µ—Å—Ç—å: `compression/compressor.py` ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å!

---

### 4.3 Smart System Prompt Caching
**–í—Ä–µ–º—è:** 4 —á–∞—Å–∞  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** üü° –°—Ä–µ–¥–Ω—è—è

```
–§–∞–π–ª: src/distiq_code/optimization/prompt_cache.py

–ß—Ç–æ –¥–µ–ª–∞–µ–º:
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å system prompt –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
- –°—Ç–∞—Ç–∏—á–Ω—ã–µ —á–∞—Å—Ç–∏ ‚Üí –≤ –Ω–∞—á–∞–ª–æ (–∫—ç—à–∏—Ä—É—é—Ç—Å—è)
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ ‚Üí –≤ –∫–æ–Ω–µ—Ü

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ system prompt:
```
[CACHED - –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏]
You are Distiq Code, an AI coding assistant...
## Your capabilities:
- Write code
- Debug
- Explain
...
## Available tools:
- file_read
- file_write
...

[–ù–ï –ö–≠–®–ò–†–£–ï–¢–°–Ø - –º–µ–Ω—è–µ—Ç—Å—è]
## Current project context:
{project_summary}

## Relevant code:
{context_chunks}
```

–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:
- [ ] 80%+ system prompt –∫—ç—à–∏—Ä—É–µ—Ç—Å—è
- [ ] cache_read_input_tokens > 0 –≤ –æ—Ç–≤–µ—Ç–∞—Ö
- [ ] –≠–∫–æ–Ω–æ–º–∏—è –≤–∏–¥–Ω–∞ –≤ cost tracker
```

---

### 4.4 Context Window Management
**–í—Ä–µ–º—è:** 3 —á–∞—Å–∞  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** üü° –°—Ä–µ–¥–Ω—è—è

```
–§–∞–π–ª: src/distiq_code/optimization/context_window.py

–ß—Ç–æ –¥–µ–ª–∞–µ–º:
- –°–ª–µ–¥–∏—Ç—å –∑–∞ —Ä–∞–∑–º–µ—Ä–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–µ–∑–∞—Ç—å –µ—Å–ª–∏ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π
- –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è: —á—Ç–æ –≤–∞–∂–Ω–µ–µ –æ—Å—Ç–∞–≤–∏—Ç—å

–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã (–æ—Ç –≤—ã—Å–æ–∫–æ–≥–æ –∫ –Ω–∏–∑–∫–æ–º—É):
1. –¢–µ–∫—É—â–∏–π –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. System prompt
3. –ü–æ—Å–ª–µ–¥–Ω–∏–µ 3 —Å–æ–æ–±—â–µ–Ω–∏—è
4. –†–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π –∫–æ–¥
5. Summary –∏—Å—Ç–æ—Ä–∏–∏
6. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç

–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:
- [ ] –ö–æ–Ω—Ç–µ–∫—Å—Ç –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ª–∏–º–∏—Ç –º–æ–¥–µ–ª–∏
- [ ] –í–∞–∂–Ω–æ–µ –Ω–µ –æ–±—Ä–µ–∑–∞–µ—Ç—Å—è
- [ ] –û–±—Ä–µ–∑–∫–∞ graceful (–Ω–µ –ª–æ–º–∞–µ—Ç —Å–º—ã—Å–ª)
```

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è Phase 4

- [ ] History summarization —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] LLMLingua —Å–∂–∏–º–∞–µ—Ç –Ω–∞ 2-3x
- [ ] Prompt caching —ç–∫–æ–Ω–æ–º–∏—Ç 50%+ –Ω–∞ input
- [ ] Context window —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è
- [ ] –û–±—â–∞—è —ç–∫–æ–Ω–æ–º–∏—è —Ç–æ–∫–µ–Ω–æ–≤: 40-60%

---

# Phase 5: Tools & Skills System

**–°—Ä–æ–∫:** –ù–µ–¥–µ–ª—è 5  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** üî¥ –í—ã—Å–æ–∫–∞—è  
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** Backend Developer  

## üîç –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ

```
–ü–ï–†–ï–î –ù–ê–ß–ê–õ–û–ú ‚Äî –ø—Ä–æ–≤–µ—Ä—å –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ:

1. "Tavily API pricing 2026"
   - –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—ã
   - –õ–∏–º–∏—Ç—ã –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ tier

2. "Anthropic Claude skills specification 2026"
   - –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç skills
   - Best practices

3. "AI agent tools architecture 2026"
   - –ö–∞–∫ –¥—Ä—É–≥–∏–µ —Ä–µ–∞–ª–∏–∑—É—é—Ç tools
   - Function calling —Ñ–æ—Ä–º–∞—Ç—ã
```

## –ó–∞–¥–∞—á–∏

### 5.1 Native Tools Framework
**–í—Ä–µ–º—è:** 4 —á–∞—Å–∞  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** üü° –°—Ä–µ–¥–Ω—è—è

```
–§–∞–π–ª: src/distiq_code/tools/base.py

–ß—Ç–æ –¥–µ–ª–∞–µ–º:
- –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è tools
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è tools
- Execution engine

–§–æ—Ä–º–∞—Ç tool:
class Tool:
    name: str
    description: str
    parameters: dict  # JSON Schema
    
    async def execute(self, params: dict) -> ToolResult

class ToolResult:
    success: bool
    output: str
    error: str | None

–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:
- [ ] Tool –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å
- [ ] Tool registry
- [ ] execute_tool(name, params) —Ä–∞–±–æ—Ç–∞–µ—Ç
```

---

### 5.2 File Operations Tool
**–í—Ä–µ–º—è:** 3 —á–∞—Å–∞  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** üü¢ –õ–µ–≥–∫–æ

```
–§–∞–π–ª: src/distiq_code/tools/file_ops.py

Tools:
- read_file(path) ‚Üí content
- write_file(path, content) ‚Üí success
- list_directory(path) ‚Üí files
- search_files(pattern) ‚Üí matches

–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:
- [ ] –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: –Ω–µ –≤—ã—Ö–æ–¥–∏–º –∑–∞ –ø—Ä–µ–¥–µ–ª—ã –ø—Ä–æ–µ–∫—Ç–∞
- [ ] –û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è gracefully
```

---

### 5.3 Terminal Tool
**–í—Ä–µ–º—è:** 3 —á–∞—Å–∞  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** üü° –°—Ä–µ–¥–Ω—è—è

```
–§–∞–π–ª: src/distiq_code/tools/terminal.py

Tools:
- run_command(command) ‚Üí output
- run_command_async(command) ‚Üí process_id

–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
- Whitelist —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
- Timeout –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
- Sandbox (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:
- [ ] –ö–æ–º–∞–Ω–¥—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è
- [ ] Timeout —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –û–ø–∞—Å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
- [ ] Output truncation –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
```

---

### 5.4 Web Search Tool
**–í—Ä–µ–º—è:** 3 —á–∞—Å–∞  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** üü¢ –õ–µ–≥–∫–æ

```
–§–∞–π–ª: src/distiq_code/tools/web_search.py

–í–∞—Ä–∏–∞–Ω—Ç—ã (–ø—Ä–æ–≤–µ—Ä—å —Ü–µ–Ω—ã!):
- Tavily API (~$0.01/search)
- Brave Search API (–µ—Å—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π tier)
- SerpAPI

Tool:
- web_search(query) ‚Üí results

–†–µ–∑—É–ª—å—Ç–∞—Ç:
[
  {
    "title": "...",
    "url": "...",
    "snippet": "..."
  }
]

–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:
- [ ] –ü–æ–∏—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ
- [ ] –¶–µ–Ω–∞ –ø—Ä–∏–µ–º–ª–µ–º–∞—è
```

---

### 5.5 Skills System
**–í—Ä–µ–º—è:** 6 —á–∞—Å–æ–≤  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** üî¥ –í—ã—Å–æ–∫–∞—è

```
–§–∞–π–ª: src/distiq_code/skills/

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ skill:
/skills/
  ‚îú‚îÄ‚îÄ deploy_docker/
  ‚îÇ   ‚îú‚îÄ‚îÄ skill.yaml      # Metadata
  ‚îÇ   ‚îú‚îÄ‚îÄ instructions.md # –ü—Ä–æ–º–ø—Ç –¥–ª—è –º–æ–¥–µ–ª–∏
  ‚îÇ   ‚îî‚îÄ‚îÄ scripts/        # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
  ‚îî‚îÄ‚îÄ setup_fastapi/
      ‚îî‚îÄ‚îÄ ...

skill.yaml:
name: deploy_docker
description: Deploy application using Docker
triggers:
  - "deploy"
  - "docker"
  - "–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä"
requires_tools:
  - terminal
  - file_ops

–ê–ª–≥–æ—Ä–∏—Ç–º –∑–∞–≥—Ä—É–∑–∫–∏:
1. Skill matcher: –ø–æ –∑–∞–ø—Ä–æ—Å—É –Ω–∞–π—Ç–∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π skill
2. –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç–æ–ª—å–∫–æ –µ–≥–æ (lazy loading)
3. –î–æ–±–∞–≤–∏—Ç—å instructions –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç
4. –í—ã–ø–æ–ª–Ω–∏—Ç—å —Å –ø–æ–º–æ—â—å—é tools

–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:
- [ ] Skills –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é
- [ ] Skill matcher –Ω–∞—Ö–æ–¥–∏—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ
- [ ] 5+ –±–∞–∑–æ–≤—ã—Ö skills —Å–æ–∑–¥–∞–Ω–æ
```

---

### 5.6 Compiled Skills (Zero-Token)
**–í—Ä–µ–º—è:** 4 —á–∞—Å–∞  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** üî¥ –í—ã—Å–æ–∫–∞—è

```
–§–∞–π–ª: src/distiq_code/skills/compiled/

–ò–¥–µ—è:
- –ù–µ–∫–æ—Ç–æ—Ä—ã–µ skills ‚Üí —á–∏—Å—Ç—ã–π Python –∫–æ–¥
- –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ, –±–µ–∑ LLM
- 0 —Ç–æ–∫–µ–Ω–æ–≤!

–ü—Ä–∏–º–µ—Ä—ã compiled skills:
- format_code: –∑–∞–ø—É—Å—Ç–∏—Ç—å black/prettier
- run_tests: pytest/jest
- git_commit: git add && git commit
- lint_code: ruff/eslint

class CompiledSkill:
    name: str
    triggers: list[str]
    
    def can_handle(self, request: str) -> bool:
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–æ–∂–µ–º –ª–∏ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ LLM
        
    def execute(self, context: dict) -> Result:
        # –í—ã–ø–æ–ª–Ω–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ

–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:
- [ ] 10+ compiled skills
- [ ] –ê–≤—Ç–æ–¥–µ—Ç–µ–∫—Ç –∫–æ–≥–¥–∞ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
- [ ] Fallback –Ω–∞ LLM –µ—Å–ª–∏ compiled –Ω–µ —Å–ø—Ä–∞–≤–∏–ª—Å—è
```

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è Phase 5

- [ ] Tools framework —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] File, Terminal, Web Search tools
- [ ] Skills –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é
- [ ] Compiled skills —ç–∫–æ–Ω–æ–º—è—Ç —Ç–æ–∫–µ–Ω—ã
- [ ] 15+ skills/tools –¥–æ—Å—Ç—É–ø–Ω–æ

---

# Phase 6: Integration & Polish

**–°—Ä–æ–∫:** –ù–µ–¥–µ–ª—è 6  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** üü° –°—Ä–µ–¥–Ω—è—è  
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –í—Å—è –∫–æ–º–∞–Ω–¥–∞  

## üîç –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ

```
–ü–ï–†–ï–î –ù–ê–ß–ê–õ–û–ú ‚Äî –ø—Ä–æ–≤–µ—Ä—å –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ:

1. "AI coding assistant UX best practices 2026"
   - –ö–∞–∫ –¥–µ–ª–∞—é—Ç –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç—ã
   - –ß—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ö–æ—Ç—è—Ç

2. "LLM application testing strategies 2026"
   - –ö–∞–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ
   - –ú–µ—Ç—Ä–∏–∫–∏

3. "Python CLI packaging 2026"
   - –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏
   - pyproject.toml vs setup.py
```

## –ó–∞–¥–∞—á–∏

### 6.1 End-to-End Testing
**–í—Ä–µ–º—è:** 6 —á–∞—Å–æ–≤  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** üü° –°—Ä–µ–¥–Ω—è—è

```
–§–∞–π–ª: tests/e2e/

–°—Ü–µ–Ω–∞—Ä–∏–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
1. Simple: "–¥–æ–±–∞–≤—å docstring –∫ —Ñ—É–Ω–∫—Ü–∏–∏ X"
2. Medium: "–Ω–∞–ø–∏—à–∏ —Ñ—É–Ω–∫—Ü–∏—é –≤–∞–ª–∏–¥–∞—Ü–∏–∏ email"
3. Complex: "—Å–æ–∑–¥–∞–π REST API –¥–ª—è users"
4. With tools: "–Ω–∞–π–¥–∏ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ –∫–∞–∫ —Å–¥–µ–ª–∞—Ç—å X –∏ —Ä–µ–∞–ª–∏–∑—É–π"
5. With skills: "–∑–∞–¥–µ–ø–ª–æ–π –≤ Docker"

–ú–µ—Ç—Ä–∏–∫–∏:
- –ö–æ–¥ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è
- –¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç (–µ—Å–ª–∏ –±—ã–ª–∏)
- Cost –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –æ–∂–∏–¥–∞–Ω–∏–π
- –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ < 30 —Å–µ–∫

–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:
- [ ] 20+ e2e —Ç–µ—Å—Ç–æ–≤
- [ ] CI pipeline –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –∑–µ–ª—ë–Ω—ã–µ
```

---

### 6.2 Cost Optimization Validation
**–í—Ä–µ–º—è:** 4 —á–∞—Å–∞  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** üü° –°—Ä–µ–¥–Ω—è—è

```
–ß—Ç–æ –¥–µ–ª–∞–µ–º:
- –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∏–º—É–ª—è—Ü–∏—é "—Ç–∏–ø–∏—á–Ω–æ–≥–æ –º–µ—Å—è—Ü–∞"
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å < $25

–°–∏–º—É–ª—è—Ü–∏—è:
- 1500 –∑–∞–ø—Ä–æ—Å–æ–≤ —Ä–∞–∑–Ω–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
- 40% cache hit rate
- Prompt compression enabled
- –í—Å–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –≤–∫–ª—é—á–µ–Ω—ã

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
- Simple (40%): 600 √ó $0.008 = $4.80
- Medium (45%): 675 √ó $0.025 = $16.88
- Complex (15%): 225 √ó $0.08 = $18.00
- Cache savings: -40%
- Total: ~$24

–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:
- [ ] –°–∏–º—É–ª—è—Ü–∏—è –ø—Ä–æ–≥–Ω–∞–Ω–∞
- [ ] –†–µ–∞–ª—å–Ω—ã–π cost < $30
- [ ] –í—Å–µ savings —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ –æ–∂–∏–¥–∞–ª–æ—Å—å
```

---

### 6.3 CLI Polish
**–í—Ä–µ–º—è:** 4 —á–∞—Å–∞  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** üü¢ –õ–µ–≥–∫–æ

```
–û–±–Ω–æ–≤–∏—Ç—å: src/distiq_code/cli.py

–ö–æ–º–∞–Ω–¥—ã:
- distiq-code start          # –ó–∞–ø—É—Å–∫ –ø—Ä–æ–∫—Å–∏
- distiq-code chat           # –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —á–∞—Ç
- distiq-code index          # –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
- distiq-code stats          # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- distiq-code cost           # –°—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞ –ø–µ—Ä–∏–æ–¥
- distiq-code config         # –ù–∞—Å—Ç—Ä–æ–π–∫–∏

UX —É–ª—É—á—à–µ–Ω–∏—è:
- –¶–≤–µ—Ç–Ω–æ–π output
- Progress bars
- –ü–æ–Ω—è—Ç–Ω—ã–µ –æ—à–∏–±–∫–∏
- --help –¥–ª—è –≤—Å–µ–≥–æ

–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:
- [ ] –í—Å–µ –∫–æ–º–∞–Ω–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] Help –ø–æ–Ω—è—Ç–Ω—ã–π
- [ ] –û—à–∏–±–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ
```

---

### 6.4 Documentation
**–í—Ä–µ–º—è:** 4 —á–∞—Å–∞  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** üü¢ –õ–µ–≥–∫–æ

```
–§–∞–π–ª—ã:
- README.md (–æ–±–Ω–æ–≤–∏—Ç—å)
- docs/QUICKSTART.md
- docs/CONFIGURATION.md
- docs/SKILLS.md
- docs/API.md

–ß—Ç–æ –≤–∫–ª—é—á–∏—Ç—å:
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞
- –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- –°–æ–∑–¥–∞–Ω–∏–µ skills
- Troubleshooting

–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:
- [ ] –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –Ω–∞—á–∞—Ç—å –∑–∞ 5 –º–∏–Ω—É—Ç
- [ ] –í—Å–µ –æ–ø—Ü–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã
- [ ] –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç
```

---

### 6.5 Performance Optimization
**–í—Ä–µ–º—è:** 4 —á–∞—Å–∞  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** üü° –°—Ä–µ–¥–Ω—è—è

```
–ß—Ç–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å:
- Cold start < 3 —Å–µ–∫—É–Ω–¥—ã
- Indexing 1000 —Ñ–∞–π–ª–æ–≤ < 60 —Å–µ–∫—É–Ω–¥
- Search < 100ms
- First response < 5 —Å–µ–∫—É–Ω–¥

–ú–µ—Ç–æ–¥—ã:
- Lazy loading –º–æ–¥–µ–ª–µ–π
- Connection pooling
- Async everywhere
- Caching –≥–æ—Ä—è—á–∏—Ö –¥–∞–Ω–Ω—ã—Ö

–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:
- [ ] –í—Å–µ –±–µ–Ω—á–º–∞—Ä–∫–∏ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç—ã
- [ ] –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–¥–µ–ª–∞–Ω–æ
- [ ] Bottlenecks —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã
```

---

### 6.6 Release Preparation
**–í—Ä–µ–º—è:** 4 —á–∞—Å–∞  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** üü¢ –õ–µ–≥–∫–æ

```
–ß—Ç–æ –¥–µ–ª–∞–µ–º:
- –í–µ—Ä—Å–∏—è 2.0.0
- CHANGELOG.md
- PyPI –ø—É–±–ª–∏–∫–∞—Ü–∏—è
- GitHub Release

Checklist:
- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –∑–µ–ª—ë–Ω—ã–µ
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞
- [ ] pyproject.toml –æ–±–Ω–æ–≤–ª—ë–Ω
- [ ] GitHub Actions –¥–ª—è release
- [ ] PyPI credentials –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
```

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è Phase 6

- [ ] E2E —Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏
- [ ] Cost < $25 –¥–ª—è heavy user
- [ ] CLI –æ—Ç–ø–æ–ª–∏—Ä–æ–≤–∞–Ω
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞–ø–∏—Å–∞–Ω–∞
- [ ] Performance –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω
- [ ] –ì–æ—Ç–æ–≤ –∫ —Ä–µ–ª–∏–∑—É

---

# üìä Summary

## Timeline

| Phase | –ù–∞–∑–≤–∞–Ω–∏–µ | –°—Ä–æ–∫ | –°–ª–æ–∂–Ω–æ—Å—Ç—å |
|-------|----------|------|-----------|
| 1 | Multi-Provider Infrastructure | Week 1 | üü° |
| 2 | Code Indexing & RAG | Week 2-3 | üî¥ |
| 3 | Adaptive Planning Router | Week 3 | üü° |
| 4 | Prompt Optimization | Week 4 | üü° |
| 5 | Tools & Skills System | Week 5 | üî¥ |
| 6 | Integration & Polish | Week 6 | üü° |

## Key Metrics

| –ú–µ—Ç—Ä–∏–∫–∞ | –¶–µ–ª—å |
|---------|------|
| Cost per heavy user | < $25/month |
| Cache hit rate | > 40% |
| First response time | < 5 seconds |
| Code quality (vs Sonnet) | > 90% |
| Test coverage | > 80% |

## Tech Stack

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è |
|-----------|------------|
| Providers | Anthropic, DeepSeek, OpenRouter |
| Parsing | Tree-sitter |
| Embeddings | Nomic Embed Code |
| Vector DB | FAISS |
| Compression | LLMLingua |
| CLI | Typer |
| HTTP | httpx (HTTP/2) |
| Server | FastAPI + Uvicorn |

---

## üñ•Ô∏è CLI –∫–æ–º–∞–Ω–¥—ã (cli.py)

### –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–º–∞–Ω–¥—ã (—É–∂–µ —Ä–∞–±–æ—Ç–∞—é—Ç):

```bash
distiq-code version      # –í–µ—Ä—Å–∏—è
distiq-code setup        # –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
distiq-code start        # –ó–∞–ø—É—Å–∫ –ø—Ä–æ–∫—Å–∏ —Å–µ—Ä–≤–µ—Ä–∞
distiq-code stats        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
distiq-code config       # –ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
distiq-code chat         # üëà –û–°–ù–û–í–ù–û–ô –ß–ê–¢ (—Å—é–¥–∞ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ–º –≤—Å—ë!)

# Cursor –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
distiq-code cursor-test     # –¢–µ—Å—Ç Cursor API
distiq-code cursor-custom   # Custom model server –¥–ª—è Cursor
distiq-code cursor-proxy    # MITM –ø—Ä–æ–∫—Å–∏ (deprecated)
```

### –ù–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã (–¥–æ–±–∞–≤–∏—Ç—å):

```bash
# Phase 2: –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è
distiq-code index              # –ò–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—É—â—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
distiq-code index --watch      # –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è + —Å–ª–µ–¥–∏—Ç—å –∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
distiq-code index-stats        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–Ω–¥–µ–∫—Å–∞ (—Ñ–∞–π–ª–æ–≤, chunks)
distiq-code search "query"     # –ü–æ–∏—Å–∫ –ø–æ –∏–Ω–¥–µ–∫—Å—É (—Ç–µ—Å—Ç)

# Phase 5: Skills
distiq-code skills             # –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö skills
distiq-code skill-add <url>    # –î–æ–±–∞–≤–∏—Ç—å skill –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
distiq-code skill-run <name>   # –ó–∞–ø—É—Å—Ç–∏—Ç—å compiled skill

# Phase 6: –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ stats
distiq-code cost               # –°—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞ –ø–µ—Ä–∏–æ–¥ (–¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è)
distiq-code cost --month       # –ó–∞ –º–µ—Å—è—Ü
distiq-code cost --breakdown   # –†–∞–∑–±–∏–≤–∫–∞ –ø–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º
```

### Slash-–∫–æ–º–∞–Ω–¥—ã –≤ —á–∞—Ç–µ (cli.py line ~568):

–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ:
```
/quit, /exit, /q  ‚Äî –í—ã—Ö–æ–¥
/clear            ‚Äî –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é
/help             ‚Äî –°–ø—Ä–∞–≤–∫–∞
/stats            ‚Äî –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ—Å—Å–∏–∏
/model opus|sonnet|haiku ‚Äî –°–º–µ–Ω–∏—Ç—å –º–æ–¥–µ–ª—å
/routing          ‚Äî –í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å smart routing
/paste            ‚Äî –í—Å—Ç–∞–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
```

–î–æ–±–∞–≤–∏—Ç—å:
```
/provider deepseek|claude|auto  ‚Äî –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã–±–æ—Ä –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
/index                          ‚Äî –ü–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
/context                        ‚Äî –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
/plan                           ‚Äî –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π –ø–ª–∞–Ω
/cost                           ‚Äî –°—Ç–æ–∏–º–æ—Å—Ç—å —Å–µ—Å—Å–∏–∏ –¥–µ—Ç–∞–ª—å–Ω–æ
/skill <name>                   ‚Äî –ó–∞–ø—É—Å—Ç–∏—Ç—å skill
/search <query>                 ‚Äî –ü–æ–∏—Å–∫ –ø–æ –∫–æ–¥—É
```

### –¢–æ—á–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ _chat_loop():

```python
# –§–∞–π–ª: src/distiq_code/cli.py

# Line ~482-486: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
# –ë–´–õ–û:
provider = ClaudeCliProvider()

# –°–¢–ê–ù–ï–¢:
from distiq_code.orchestrator import Orchestrator
orchestrator = Orchestrator(
    indexer=get_indexer(),      # Phase 2
    providers=get_providers(),   # Phase 1
    cache=get_cache(),           # Already exists
    compressor=get_compressor(), # Already exists
    cost_tracker=get_cost_tracker(),
)

# Line ~657: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
# –ë–´–õ–û:
messages.append({"role": "user", "content": user_input})

# –°–¢–ê–ù–ï–¢:
context = await orchestrator.build_context(user_input)  # Phase 2
messages.append({
    "role": "user", 
    "content": user_input,
    "context": context,  # –ë—É–¥–µ—Ç inject'–∏—Ç—å—Å—è –≤ –ø—Ä–æ–º–ø—Ç
})

# Line ~725-726: –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞
# –ë–´–õ–û:
stream = await provider.complete(messages_to_send, routed_model, ...)

# –°–¢–ê–ù–ï–¢:
response = await orchestrator.process(
    request=user_input,
    messages=messages_to_send,
    preferred_model=routed_model,
    stream=True,
)
```

---

*–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 6 —Ñ–µ–≤—Ä–∞–ª—è 2026*

